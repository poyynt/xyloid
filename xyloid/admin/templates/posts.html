{% extends "admin_base.html" %}
{% block title %}Posts{% endblock %}
{% block head %}
<script src="{{ url_for('static', filename='moment.min.js') }}"></script>
<script src="{{ url_for('static', filename='moment-timezone-with-data.min.js') }}"></script>
<script>
	function fetchPage(page = 1) {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var j = JSON.parse(this.responseText);
				for (var i = 0; i < j.length; i++) {
					var tr = document.createElement("tr");
					var name = document.createElement("td");
					name.innerText = j[i].name;
					var uuid = document.createElement("td");
					uuid.innerText = j[i].uuid;
					var shortlink = document.createElement("td");
					var shortlink_a = document.createElement("a")
					shortlink_a.href = "{{ url_for('post.by_shortlink', shortlink='') }}" + j[i].shortlink;
					shortlink_a.innerText = j[i].shortlink;
					shortlink.appendChild(shortlink_a);
					var uuid = document.createElement("td");
					var uuid_a = document.createElement("a")
					uuid_a.href = "{{ url_for('post.by_uuid', uuid='') }}" + j[i].uuid;
					uuid_a.innerText = j[i].uuid;
					uuid.appendChild(uuid_a);
					var created = document.createElement("td")
					var localDate = moment(j[i].created).format("dddd, MMMM Do YYYY, H:mm");
					created.innerText = localDate;
					name.classList.add("px-4", "py-2", "border", "border-2px", "border-gray-500", "border-solid");
					uuid.classList.add("px-4", "py-2", "border", "border-2px", "border-gray-500", "border-solid");
					shortlink.classList.add("px-4", "py-2", "border", "border-2px", "border-gray-500", "border-solid");
					created.classList.add("px-4", "py-2", "border", "border-2px", "border-gray-500", "border-solid");
					if (i % 2 == 1) {
						tr.classList.add("bg-gray-200");
					}
					tr.appendChild(name);
					tr.appendChild(uuid);
					tr.appendChild(shortlink);
					tr.appendChild(created);
					document.getElementById("postsbody").appendChild(tr);
				}
			}
		};
		xhttp.open("GET", "{{ url_for('api.all_posts') }}" + "/" + page, true);
		xhttp.send();
	}
	document.addEventListener("load", fetchPage());
</script>
{% endblock %}
{% block body %}
<main>
	<p class="text-center mr-auto ml-auto my-4">Posts</p>
	<table id="posts" class="table-auto mr-auto ml-auto my-8">
		<thead>
			<tr>
				<th class="px-4 py-2">Name</th>
				<th class="px-4 py-2">UUID</th>
				<th class="px-4 py-2">Shortlink</th>
				<th class="px-4 py-2">Created</th>
			</tr>
		</thead>
		<tbody id="postsbody">
		</tbody>
	</table>
</main>
{% endblock %}
